{"version":3,"sources":["Menu.js"],"names":["i18n","require","SceneList","cc","Class","extends","Component","properties","text","default","type","Label","readme","ScrollView","btnInfo","Button","btnBack","testList","onLoad","_isLoadingScene","showDebugDraw","game","addPersistRootNode","node","currentSceneUrl","contentPos","isMenu","active","loadInstruction","zIndex","content","sceneList","getComponent","init","cocosAnalytics","CAEvent","onEvent","eventName","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","KEY","b","backToList","_updateInfoButton","showReadme","director","loadScene","onLoadSceneFinish","bind","url","getContentPosition","CALevels","begin","level","setContentPosition","self","urlArr","split","fileName","length","replace","loader","loadRes","err","txt","string","t","labelTxt","find","textKey","undefined","scrollToTop","enabledDebugDraw","getCollisionManager","videoPlayer","restart","gc","sys","garbageCollect"],"mappings":"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","file":"Menu.js","sourceRoot":"../../../../../assets/scripts/Global","sourcesContent":["const i18n = require('i18n');\nconst SceneList = require('SceneList');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        text: {\n            default: null,\n            type: cc.Label\n        },\n        readme: {\n            default: null,\n            type: cc.ScrollView\n        },\n        btnInfo: {\n            default: null,\n            type: cc.Button\n        },\n        btnBack: {\n            default: null,\n            type: cc.Button\n        },\n        testList: {\n            default: null,\n            type: cc.ScrollView\n        }\n    },\n\n    onLoad: function () {\n        this._isLoadingScene = false;\n        this.showDebugDraw = false;\n        cc.game.addPersistRootNode(this.node);\n        this.currentSceneUrl = 'TestList.fire';\n        this.contentPos = null;\n        this.isMenu = true;\n        this.btnBack.node.active = false;\n        this.loadInstruction(this.currentSceneUrl);\n        this.node.zIndex = 999;\n\n        cc.game.addPersistRootNode(this.testList.node);\n        if (this.testList && this.testList.content) {\n            // in main scene\n            this.sceneList = this.testList.content.getComponent('SceneList');\n            this.sceneList.init(this);\n        }\n        if (typeof cocosAnalytics !== 'undefined') {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CAEvent.onEvent({\n                eventName: \"打开范例\"\n            });\n        }\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, (event) => {\n            if (event.keyCode === cc.KEY.b) {\n                this.backToList();\n            }\n        }, this);\n\n        this._updateInfoButton();\n    },\n\n    backToList: function () {\n        if (this._isLoadingScene) {\n            return;\n        }\n        this._isLoadingScene = true;\n        this.showReadme(null, false);\n        this.currentSceneUrl = 'TestList.fire';\n        this.isMenu = true;\n        cc.director.loadScene('TestList', this.onLoadSceneFinish.bind(this));\n    },\n\n    loadScene: function (url) {\n        this._isLoadingScene = true;\n        this.contentPos = this.testList.getContentPosition();\n        this.currentSceneUrl = url;\n        this.isMenu = false;\n        this.testList.node.active = false;\n        cc.director.loadScene(url, this.onLoadSceneFinish.bind(this));\n        if (typeof cocosAnalytics !== 'undefined') {\n            // Cocos Analytics service, to learn more please visit:\n            // https://analytics.cocos.com/docs/\n            cocosAnalytics.CALevels.begin({\n                level: url\n            });\n        }\n    },\n\n    onLoadSceneFinish: function () {\n        let url = this.currentSceneUrl;\n        this.loadInstruction(url);\n        if (this.isMenu && this.contentPos) {\n            this.btnBack.node.active = false;\n            this.testList.node.active = true;\n            this.testList.setContentPosition(this.contentPos);\n        }\n        else {\n            this.btnBack.node.active = true;\n            this.testList.node.active = false;\n        }\n        this._isLoadingScene = false;\n    },\n\n    loadInstruction: function (url) {\n        let self = this;\n        let urlArr = url.split('/');\n        let fileName = urlArr[urlArr.length - 1].replace('.fire', '');\n        cc.loader.loadRes('readme/' + fileName, function(err, txt) {\n            if (err) {\n                self.text.string = i18n.t(\"scripts/Global/Menu.js.1\");\n                return;\n            }\n            self.text.string = txt;\n        });\n    },\n\n    _updateInfoButton: function () {\n        let labelTxt = i18n.t(\"scripts/Global/Menu.js.\" + (this.readme.node.active ? \"view\" : \"hide\") + \".info\");\n        cc.find('label', this.btnInfo.node).getComponent(cc.Label).textKey = labelTxt;\n    },\n\n    showReadme: function (event, active) {\n        if (active === undefined) {\n            this.readme.node.active = !this.readme.node.active;\n        }\n        else {\n            this.readme.node.active = active;\n        }\n        if (this.readme.node.active) {\n            this.readme.scrollToTop();\n        }\n        this._updateInfoButton()\n\n        // en: fix Collider DebugDraw always displayed on top of the problem.\n        // zh：解决 Collider DebugDraw 一直显示在最上层的问题。\n        var enabledDebugDraw = cc.director.getCollisionManager().enabledDebugDraw;\n        if (this.readme.node.active) {\n            this.showDebugDraw = enabledDebugDraw;\n            cc.director.getCollisionManager().enabledDebugDraw = false;\n        }\n        else {\n            cc.director.getCollisionManager().enabledDebugDraw = this.showDebugDraw;\n        }\n        // en: fix Video Player always displayed on top of the problem.\n        // zh：修复 Video Player 一直显示在最上层的问题。\n        var videoPlayer = cc.find('Canvas/VideoPlayer');\n        if (videoPlayer) {\n            videoPlayer.active = !this.readme.node.active;\n        }\n    },\n\n    restart: function () {\n        cc.game.restart();\n    },\n    \n    gc: function () {\n        cc.sys.garbageCollect();\n    }\n});\n"]}