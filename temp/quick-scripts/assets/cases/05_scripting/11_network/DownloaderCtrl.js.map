{"version":3,"sources":["DownloaderCtrl.js"],"names":["cc","Class","extends","Component","properties","label","Label","sprite","Sprite","imgUrl","txtUrl","_downloader","_imgTask","_txtTask","_storagePath","_inited","onLoad","CC_JSB","string","jsb","Downloader","setOnFileTaskSuccess","onSucceed","bind","setOnTaskProgress","onProgress","setOnTaskError","onError","fileUtils","getWritablePath","createDirectory","task","atlasRelated","requestURL","self","loader","load","storagePath","err","tex","spriteFrame","SpriteFrame","node","active","content","getStringFromFile","substr","bytesReceived","totalBytesReceived","totalBytesExpected","errorCode","errorCodeInternal","errorStr","downloadImg","createDownloadFileTask","downloadTxt"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,eAAOL,GAAGM,KADF;AAERC,gBAAQP,GAAGQ,MAFH;AAGRC,gBAAQ,gEAHA;AAIRC,gBAAQ,2EAJA;AAKRC,qBAAa,IALL;AAMRC,kBAAU,IANF;AAORC,kBAAU,IAPF;AAQRC,sBAAc,EARN;AASRC,iBAAS;AATD,KAHP;;AAeL;AACAC,UAhBK,oBAgBK;AACN,YAAI,CAACC,MAAL,EAAa;AACT,iBAAKZ,KAAL,CAAWa,MAAX,GAAoB,sCAApB;AACA;AACH;;AAED,aAAKP,WAAL,GAAmB,IAAIQ,IAAIC,UAAR,EAAnB;AACA,aAAKT,WAAL,CAAiBU,oBAAjB,CAAsC,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAtC;AACA,aAAKZ,WAAL,CAAiBa,iBAAjB,CAAmC,KAAKC,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAnC;AACA,aAAKZ,WAAL,CAAiBe,cAAjB,CAAgC,KAAKC,OAAL,CAAaJ,IAAb,CAAkB,IAAlB,CAAhC;;AAEA,aAAKT,YAAL,GAAoBK,IAAIS,SAAJ,CAAcC,eAAd,KAAkC,4BAAtD;AACA,aAAKd,OAAL,GAAeI,IAAIS,SAAJ,CAAcE,eAAd,CAA8B,KAAKhB,YAAnC,CAAf;AACA,YAAI,CAAC,KAAKC,OAAV,EAAmB;AACf,iBAAKV,KAAL,CAAWa,MAAX,GAAoB,iEAApB;AACH;AACJ,KAhCI;AAkCLI,aAlCK,qBAkCMS,IAlCN,EAkCY;AACb,YAAIC,eAAe,KAAnB;AACA,gBAAQD,KAAKE,UAAb;AACA,iBAAK,KAAKxB,MAAV;AACI,oBAAIyB,OAAO,IAAX;AACAlC,mBAAGmC,MAAH,CAAUC,IAAV,CAAeL,KAAKM,WAApB,EAAiC,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACjD,wBAAIC,cAAc,IAAIxC,GAAGyC,WAAP,CAAmBF,GAAnB,CAAlB;AACAL,yBAAK3B,MAAL,CAAYiC,WAAZ,GAA0BA,WAA1B;;AAEAN,yBAAK3B,MAAL,CAAYmC,IAAZ,CAAiBC,MAAjB,GAA0B,IAA1B;AACAT,yBAAK7B,KAAL,CAAWqC,IAAX,CAAgBC,MAAhB,GAAyB,KAAzB;AACH,iBAND;AAOA;AACJ,iBAAK,KAAKjC,MAAV;AACI,oBAAIkC,UAAUzB,IAAIS,SAAJ,CAAciB,iBAAd,CAAgCd,KAAKM,WAArC,CAAd;AACA,qBAAK9B,MAAL,CAAYmC,IAAZ,CAAiBC,MAAjB,GAA0B,KAA1B;AACA,qBAAKtC,KAAL,CAAWqC,IAAX,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,qBAAKtC,KAAL,CAAWa,MAAX,GAAoB0B,QAAQE,MAAR,CAAe,CAAf,EAAkB,GAAlB,CAApB;AACA;AAhBJ;AAkBH,KAtDI;AAwDLrB,cAxDK,sBAwDOM,IAxDP,EAwDagB,aAxDb,EAwD4BC,kBAxD5B,EAwDgDC,kBAxDhD,EAwDoE,CAExE,CA1DI;AA4DLtB,WA5DK,mBA4DII,IA5DJ,EA4DUmB,SA5DV,EA4DqBC,iBA5DrB,EA4DwCC,QA5DxC,EA4DkD;AACnD,aAAK7C,MAAL,CAAYmC,IAAZ,CAAiBC,MAAjB,GAA0B,KAA1B;AACA,aAAKtC,KAAL,CAAWqC,IAAX,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,aAAKtC,KAAL,CAAWa,MAAX,GAAoB,8BAA8Ba,KAAKE,UAAnC,GAAgD,KAAhD,GAAwDmB,QAAxD,GAAmE,GAAnE,GAAyEF,SAAzE,GAAqF,GAAzG;AACH,KAhEI;AAkELG,eAlEK,yBAkEU;AACX,YAAI,CAAC,KAAK5C,MAAN,IAAgB,CAAC,KAAKM,OAA1B,EAAmC;AAC/B;AACH;AACD,aAAKH,QAAL,GAAgB,KAAKD,WAAL,CAAiB2C,sBAAjB,CAAwC,KAAK7C,MAA7C,EAAqD,KAAKK,YAAL,GAAoB,eAAzE,CAAhB;AACH,KAvEI;AAyELyC,eAzEK,yBAyEU;AACX,YAAI,CAAC,KAAK7C,MAAN,IAAgB,CAAC,KAAKK,OAA1B,EAAmC;AAC/B;AACH;AACD,aAAKF,QAAL,GAAgB,KAAKF,WAAL,CAAiB2C,sBAAjB,CAAwC,KAAK5C,MAA7C,EAAqD,KAAKI,YAAL,GAAoB,aAAzE,CAAhB;AACH;AA9EI,CAAT","file":"DownloaderCtrl.js","sourceRoot":"../../../../../../assets/cases/05_scripting/11_network","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        label: cc.Label,\n        sprite: cc.Sprite,\n        imgUrl: \"http://www.cocos.com/wp-content/themes/cocos/img/download1.png\",\n        txtUrl: \"http://api.lololyrics.com/0.5/getLyric?artist=John%20Lennon&track=Imagine\",\n        _downloader: null,\n        _imgTask: null,\n        _txtTask: null,\n        _storagePath: \"\",\n        _inited: false\n    },\n\n    // use this for initialization\n    onLoad () {\n        if (!CC_JSB) {\n            this.label.string = 'Downloader is a NATIVE ONLY feature.';\n            return;\n        }\n\n        this._downloader = new jsb.Downloader();\n        this._downloader.setOnFileTaskSuccess(this.onSucceed.bind(this));\n        this._downloader.setOnTaskProgress(this.onProgress.bind(this));\n        this._downloader.setOnTaskError(this.onError.bind(this));\n\n        this._storagePath = jsb.fileUtils.getWritablePath() + '/example-cases/downloader/';\n        this._inited = jsb.fileUtils.createDirectory(this._storagePath);\n        if (!this._inited) {\n            this.label.string = 'Failed to create storage path, downloader won\\'t work correctly';\n        }\n    },\n\n    onSucceed (task) {\n        var atlasRelated = false;\n        switch (task.requestURL) {\n        case this.imgUrl:\n            var self = this;\n            cc.loader.load(task.storagePath, function (err, tex) {\n                var spriteFrame = new cc.SpriteFrame(tex);\n                self.sprite.spriteFrame = spriteFrame;\n\n                self.sprite.node.active = true;\n                self.label.node.active = false;\n            });\n            break;\n        case this.txtUrl:\n            var content = jsb.fileUtils.getStringFromFile(task.storagePath);\n            this.sprite.node.active = false;\n            this.label.node.active = true;\n            this.label.string = content.substr(0, 350);\n            break;\n        }\n    },\n\n    onProgress (task, bytesReceived, totalBytesReceived, totalBytesExpected) {\n\n    },\n\n    onError (task, errorCode, errorCodeInternal, errorStr) {\n        this.sprite.node.active = false;\n        this.label.node.active = true;\n        this.label.string = 'Failed to download file (' + task.requestURL + '): ' + errorStr + '(' + errorCode + ')';\n    },\n\n    downloadImg () {\n        if (!this.imgUrl || !this._inited) {\n            return;\n        }\n        this._imgTask = this._downloader.createDownloadFileTask(this.imgUrl, this._storagePath + 'download1.png');\n    },\n\n    downloadTxt () {\n        if (!this.txtUrl || !this._inited) {\n            return;\n        }\n        this._txtTask = this._downloader.createDownloadFileTask(this.txtUrl, this._storagePath + 'imagine.txt');\n    }\n});\n"]}