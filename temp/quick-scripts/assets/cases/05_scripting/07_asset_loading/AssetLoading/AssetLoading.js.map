{"version":3,"sources":["AssetLoading.js"],"names":["i18n","require","cc","Class","extends","Component","properties","showWindow","Node","loadAnimTestPrefab","Prefab","loadTips","Label","loadList","default","type","onLoad","_curType","_lastType","_curRes","_btnLabel","_audioSource","_isLoading","_urls","Audio","Txt","Texture","Font","Plist","url","raw","SpriteFrame","Animation","Scene","Spine","CORS","_onRegisteredEvent","i","length","on","EventType","TOUCH_END","_onClick","bind","event","_onClear","target","name","split","_onShowResClick","textKey","t","getChildByName","getComponent","_load","loadCallBack","_loadCallBack","loader","loadRes","sp","SkeletonData","load","err","res","log","removeAllChildren","AudioSource","stop","director","runScene","scene","releaseAsset","_createNode","node","setPosition","component","addComponent","Sprite","spriteFrame","clip","play","lineHeight","string","font","ParticleSystem","file","resetSystem","prefab","instantiate","parent","loadAnim","AanimCtrl","addClip","Skeleton","skeletonData","animation","y","addChild"],"mappings":"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","file":"AssetLoading.js","sourceRoot":"../../../../../../../assets/cases/05_scripting/07_asset_loading/AssetLoading","sourcesContent":["const i18n = require('i18n');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        showWindow: cc.Node,\n        loadAnimTestPrefab: cc.Prefab,\n        loadTips: cc.Label,\n        loadList: {\n            default: [],\n            type: cc.Node\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // cur load Target\n        this._curType = \"\";\n        this._lastType = \"\";\n        this._curRes = null;\n        this._btnLabel = null;\n        this._audioSource = null;\n        this._isLoading = false;\n        // add load res url\n        this._urls = {\n            // Raw Asset\n            Audio: \"test assets/audio\",\n            Txt: \"test assets/text\",\n            Texture: \"test assets/PurpleMonster\",\n            Font: \"test assets/font\",\n            // Raw Asset, use raw url\n            Plist: cc.url.raw(\"resources/test assets/atom.plist\"),\n            // Asset\n            SpriteFrame: \"test assets/image\",\n            Prefab: \"test assets/prefab\",\n            Animation: \"test assets/sprite-anim\",\n            Scene: \"test assets/scene\",\n            Spine: \"spineboy/spineboy\",\n            CORS: \"http://tools.itharbors.com/res/logo.png\",\n        };\n        // registered event\n        this._onRegisteredEvent();\n    },\n\n    _onRegisteredEvent: function () {\n        for (var i = 0; i < this.loadList.length; ++i) {\n            this.loadList[i].on(cc.Node.EventType.TOUCH_END, this._onClick.bind(this));\n        }\n    },\n\n    _onClick: function (event) {\n        if (this._isLoading) {\n            return;\n        }\n\n        this._onClear();\n\n        this._curType = event.target.name.split('_')[1];\n        if (this._lastType !== \"\" && this._curType === this._lastType) {\n            this._onShowResClick(event);\n            return;\n        }\n\n        if (this._btnLabel) {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.1\") + this._lastType;\n        }\n\n        this._lastType = this._curType;\n\n        this._btnLabel = event.target.getChildByName(\"Label\").getComponent(\"cc.Label\");\n\n        this.loadTips.textKey = this._curType + \" Loading....\";\n        this._isLoading = true;\n\n        this._load();\n    },\n\n    _load: function () {\n        var url = this._urls[this._curType];\n        var loadCallBack = this._loadCallBack.bind(this);\n        switch (this._curType) {\n            case 'SpriteFrame':\n                // specify the type to load sub asset from texture's url\n                cc.loader.loadRes(url, cc.SpriteFrame, loadCallBack);\n                break;\n            case 'Spine':\n                // specify the type to avoid the duplicated name from spine atlas\n                cc.loader.loadRes(url, sp.SkeletonData, loadCallBack);\n                break;\n            case 'Font':\n                cc.loader.loadRes(url, cc.Font, loadCallBack);\n                break;\n            case 'Animation':\n            case 'Prefab':\n            case 'Scene':\n            case 'Texture':\n            case 'Txt':\n            case 'Audio':\n                cc.loader.loadRes(url, loadCallBack);\n                break;\n            case 'CORS':\n                cc.loader.load(url, loadCallBack);\n                this.loadTips.textKey = \"CORS image should report texImage2D error under WebGL and works ok under Canvas\"\n                break;\n            default:\n                cc.loader.load(url, loadCallBack);\n                break;\n        }\n    },\n\n    _loadCallBack: function (err, res) {\n        this._isLoading = false;\n        if (err) {\n            cc.log('Error url [' + err + ']');\n            return;\n        }\n        this._curRes = res;\n        if (this._curType === \"Audio\") {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.2\");\n        }\n        else {\n            this._btnLabel.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.3\");\n        }\n        this._btnLabel.textKey += this._curType;\n        this.loadTips.textKey = this._curType + \" Loaded Successfully!\";\n    },\n\n    _onClear: function () {\n        this.showWindow.removeAllChildren(true);\n        if (this._audioSource && this._audioSource instanceof cc.AudioSource) {\n            this._audioSource.stop();\n        }\n    },\n\n    _onShowResClick: function (event) {\n        if (this._curType === \"Scene\") {\n            cc.director.runScene(this._curRes.scene);\n            cc.loader.releaseAsset(this._curRes);\n            this._curRes = null;\n\n            return;\n        }\n        this._createNode(this._curType, this._curRes);\n    },\n\n    _createNode: function (type, res) {\n        this.loadTips.textKey = \"\";\n        var node = new cc.Node(\"New \" + type);\n        node.setPosition(0, 0);\n        var component = null;\n        switch (this._curType) {\n            case \"SpriteFrame\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = res;\n                break;\n            case \"Texture\":\n            case \"CORS\":\n                component = node.addComponent(cc.Sprite);\n                component.spriteFrame = new cc.SpriteFrame(res);\n                break;\n            case \"Audio\":\n                component = node.addComponent(cc.AudioSource);\n                component.clip = res;\n                component.play();\n                this._audioSource = component;\n                this.loadTips.textKey = i18n.t(\"cases/05_scripting/07_asset_loading/AssetLoading.js.4\");\n                break;\n            case \"Txt\":\n                component = node.addComponent(cc.Label);\n                component.lineHeight = 40;\n                component.string = res;\n                break;\n            case \"Font\":\n                component = node.addComponent(cc.Label);\n                component.font = res;\n                component.lineHeight = 40;\n                component.string = \"This is BitmapFont!\";\n                break;\n            case \"Plist\":\n                component = node.addComponent(cc.ParticleSystem);\n                component.file = this._urls.Plist;\n                component.resetSystem();\n                break;\n            case \"Prefab\":\n                var prefab = cc.instantiate(res);\n                prefab.parent = node;\n                prefab.setPosition(0, 0);\n                break;\n            case \"Animation\":\n                var loadAnim = cc.instantiate(this.loadAnimTestPrefab);\n                loadAnim.parent = node;\n                loadAnim.setPosition(0, 0);\n                var AanimCtrl = loadAnim.getComponent(cc.Animation);\n                AanimCtrl.addClip(res);\n                AanimCtrl.play(res.name);\n                break;\n            case \"Spine\":\n                component = node.addComponent(sp.Skeleton);\n                component.skeletonData = res;\n                component.animation = \"walk\";\n                node.y = -248;\n                break;\n        }\n        this.showWindow.addChild(node);\n    }\n});\n"]}