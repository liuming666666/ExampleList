{"version":3,"sources":["../../../../../assets/cases/dragonbones/assets/cases/dragonbones/DragonBonesCtrl.js"],"names":["cc","runtime","NORMAL_ANIMATION_GROUP","AIM_ANIMATION_GROUP","ATTACK_ANIMATION_GROUP","JUMP_SPEED","NORMALIZE_MOVE_SPEED","MAX_MOVE_SPEED_FRONT","MAX_MOVE_SPEED_BACK","WEAPON_R_LIST","WEAPON_L_LIST","GROUND","G","Class","extends","Component","editor","requireComponent","dragonBones","ArmatureDisplay","properties","touchHandler","default","type","Node","upButton","downButton","leftButton","rightButton","_bullets","_left","_right","_isJumpingA","_isJumpingB","_isSquating","_isAttackingA","_isAttackingB","_weaponRIndex","_weaponLIndex","_faceDir","_aimDir","_moveDir","_aimRadian","_speedX","_speedY","_armature","_armatureDisplay","_weaponR","_weaponL","_aimState","_walkState","_attackState","_target","p","onLoad","getComponent","armature","addEventListener","EventObject","FADE_IN_COMPLETE","_animationEventHandler","FADE_OUT_COMPLETE","getSlot","displayController","childArmature","FRAME_EVENT","_frameEventHandler","_updateAnimation","WorldClock","clock","add","on","EventType","TOUCH_START","attack","TOUCH_END","TOUCH_MOVE","touches","event","getTouches","touchLoc","getLocation","aim","x","y","jump","squat","TOUCH_CANCEL","_updateMove","eventManager","addListener","EventListener","KEYBOARD","onKeyPressed","keyCode","_keyHandler","onKeyReleased","node","isDown","KEY","a","left","d","right","w","up","s","down","q","switchWeaponR","e","switchWeaponL","space","dir","move","animation","fadeIn","isSquating","isAttacking","removeEventListener","length","newWeaponName","buildArmature","parent","convertToNodeSpaceAR","update","dt","_updatePosition","_updateAim","_updateAttack","_enterFrameHandler","onDisable","i","bullet","doClean","remove","addBullet","push","splice","advanceTime","detail","animationState","name","firePointBone","getBone","localPoint","global","display","globalPoint","convertToWorldSpace","_fire","firePoint","Math","random","effect","radian","PI","DragonBullet","init","_sgNode","timeScale","minX","visibleRect","width","maxX","scaleX","aimOffsetY","scaleY","atan2","aimDir","AnimationFadeOutMode","SameGroup","weight","abs","invalidUpdate","autoFadeOutTime","fadeTotalTime","addBoneMask","_effect","parentNode","speed","position","cos","sin","thePos","convertToNodeSpace","setPosition","rotation","DragonBones","RADIAN_TO_ANGLE","play","effectDisplay","addChild","worldPos","getPosition","height","removeFromParent","dispose"],"mappings":"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","file":"DragonBonesCtrl.js","sourceRoot":"../../../../../assets/cases/dragonbones","sourcesContent":["\nif (!cc.runtime) {\n// runtime not support dragonbones.\n\nvar NORMAL_ANIMATION_GROUP = \"normal\";\nvar AIM_ANIMATION_GROUP = \"aim\";\nvar ATTACK_ANIMATION_GROUP = \"attack\";\nvar JUMP_SPEED = -20;\nvar NORMALIZE_MOVE_SPEED = 3.6;\nvar MAX_MOVE_SPEED_FRONT = NORMALIZE_MOVE_SPEED * 1.4;\nvar MAX_MOVE_SPEED_BACK = NORMALIZE_MOVE_SPEED * 1.0;\nvar WEAPON_R_LIST = [\"weapon_1502b_r\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\", \"weapon_1005e\"];\nvar WEAPON_L_LIST = [\"weapon_1502b_l\", \"weapon_1005\", \"weapon_1005b\", \"weapon_1005c\", \"weapon_1005d\"];\nvar GROUND = -200;\nvar G = -0.6;\n\ncc.Class({\n    extends: cc.Component,\n    editor: {\n        requireComponent: dragonBones.ArmatureDisplay\n    },\n\n    properties: {\n        touchHandler : {\n            default: null,\n            type: cc.Node\n        },\n\n        upButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        downButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        leftButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        rightButton: {\n            default: null,\n            type: cc.Node\n        },\n\n        _bullets : [],\n        _left : false,\n        _right : false,\n        _isJumpingA : false,\n        _isJumpingB : false,\n        _isSquating : false,\n        _isAttackingA : false,\n        _isAttackingB : false,\n        _weaponRIndex : 0,\n        _weaponLIndex : 0,\n        _faceDir : 1,\n        _aimDir : 0,\n        _moveDir : 0,\n        _aimRadian : 0,\n        _speedX : 0,\n        _speedY : 0,\n        _armature : null,\n        _armatureDisplay : null,\n        _weaponR : null,\n        _weaponL : null,\n        _aimState : null,\n        _walkState : null,\n        _attackState : null,\n        _target : cc.p(0, 0),\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._armatureDisplay = this.getComponent(dragonBones.ArmatureDisplay);\n        this._armature = this._armatureDisplay.armature();\n\n        this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE, this._animationEventHandler, this);\n        this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE, this._animationEventHandler, this);\n\n        this._armature.getSlot('effects_1').displayController = NORMAL_ANIMATION_GROUP;\n        this._armature.getSlot('effects_2').displayController = NORMAL_ANIMATION_GROUP;\n\n        this._weaponR = this._armature.getSlot('weapon_r').childArmature;\n        this._weaponL = this._armature.getSlot('weapon_l').childArmature;\n        this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n        this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._updateAnimation();\n        dragonBones.WorldClock.clock.add(this._armature);\n\n        if (this.touchHandler) {\n            // touch events\n            this.touchHandler.on(cc.Node.EventType.TOUCH_START, event => {\n                this.attack(true);\n            }, this);\n            this.touchHandler.on(cc.Node.EventType.TOUCH_END, event => {\n                this.attack(false);\n            }, this);\n            this.touchHandler.on(cc.Node.EventType.TOUCH_MOVE, event => {\n                var touches = event.getTouches();\n                var touchLoc = touches[0].getLocation();\n                this.aim(touchLoc.x, touchLoc.y);\n            }, this);\n        }\n\n        if (this.upButton) {\n            this.upButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this.jump();\n            }, this);\n        }\n\n        if (this.downButton) {\n            this.downButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this.squat(true);\n            }, this);\n            this.downButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this.squat(false);\n            }, this);\n            this.downButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this.squat(false);\n            }, this);\n        }\n\n        if (this.leftButton) {\n            this.leftButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this._left = true;\n                this._updateMove(-1);\n            }, this);\n            this.leftButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this._left = false;\n                this._updateMove(-1);\n            }, this);\n            this.leftButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this._left = false;\n                this._updateMove(-1);\n            }, this);\n        }\n\n        if (this.rightButton) {\n            this.rightButton.on(cc.Node.EventType.TOUCH_START, event => {\n                this._right = true;\n                this._updateMove(1);\n            }, this);\n            this.rightButton.on(cc.Node.EventType.TOUCH_END, event => {\n                this._right = false;\n                this._updateMove(1);\n            }, this);\n            this.rightButton.on(cc.Node.EventType.TOUCH_CANCEL, event => {\n                this._right = false;\n                this._updateMove(1);\n            }, this);\n        }\n\n        // keyboard events\n        cc.eventManager.addListener({\n            event: cc.EventListener.KEYBOARD,\n            onKeyPressed: (keyCode, event) => {\n                this._keyHandler(keyCode, true);\n            },\n            onKeyReleased: (keyCode, event) => {\n                this._keyHandler(keyCode, false);\n            },\n        }, this.node);\n    },\n\n    _keyHandler: function(keyCode, isDown) {\n        switch(keyCode) {\n            case cc.KEY.a:\n            case cc.KEY.left:\n                this._left = isDown;\n                this._updateMove(-1);\n                break;\n            case cc.KEY.d:\n            case cc.KEY.right:\n                this._right = isDown;\n                this._updateMove(1);\n                break;\n            case cc.KEY.w:\n            case cc.KEY.up:\n                if (isDown) {\n                    this.jump();\n                }\n                break;\n            case cc.KEY.s:\n            case cc.KEY.down:\n                this.squat(isDown);\n                break;\n            case cc.KEY.q:\n                if (isDown) {\n                    this.switchWeaponR();\n                }\n                break;\n            case cc.KEY.e:\n                if (isDown) {\n                    this.switchWeaponL();\n                }\n                break;\n            case cc.KEY.space:\n                if (isDown) {\n                    this.switchWeaponR();\n                    this.switchWeaponL();\n                }\n                break;\n            default:\n                return;\n        }\n    },\n\n    _updateMove : function (dir) {\n        if (this._left && this._right) {\n            this.move(dir);\n        } else if (this._left) {\n            this.move(-1);\n        } else if (this._right) {\n            this.move(1);\n        } else {\n            this.move(0);\n        }\n    },\n\n    move : function(dir) {\n        if (this._moveDir === dir) {\n            return;\n        }\n\n        this._moveDir = dir;\n        this._updateAnimation();\n    },\n\n    jump : function () {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        this._isJumpingA = true;\n        this._armature.animation.fadeIn(\"jump_1\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n        this._walkState = null;\n    },\n\n    squat : function(isSquating) {\n        if (this._isSquating === isSquating) {\n            return;\n        }\n\n        this._isSquating = isSquating;\n        this._updateAnimation();\n    },\n\n    attack : function (isAttacking) {\n        if (this._isAttackingA == isAttacking) {\n            return;\n        }\n\n        this._isAttackingA = isAttacking;\n    },\n\n    switchWeaponL : function() {\n        this._weaponL.removeEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponLIndex = (this._weaponLIndex + 1) % WEAPON_L_LIST.length;\n        var newWeaponName = WEAPON_L_LIST[this._weaponLIndex];\n        this._weaponL = this._armatureDisplay.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_l').childArmature = this._weaponL;\n\n        this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    },\n\n    switchWeaponR : function() {\n        this._weaponR.removeEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n\n        this._weaponRIndex = (this._weaponRIndex + 1) % WEAPON_R_LIST.length;\n        var newWeaponName = WEAPON_R_LIST[this._weaponRIndex];\n        this._weaponR = this._armatureDisplay.buildArmature(newWeaponName);\n        this._armature.getSlot('weapon_r').childArmature = this._weaponR;\n\n        this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT, this._frameEventHandler, this);\n    },\n\n    aim : function(x, y) {\n        if (this._aimDir === 0) {\n            this._aimDir = 10;\n        }\n\n        this._target = this.node.parent.convertToNodeSpaceAR(cc.p(x, y));\n    },\n\n    update : function (dt) {\n        this._updatePosition();\n        this._updateAim();\n        this._updateAttack();\n        this._enterFrameHandler(dt);\n    },\n\n    onDisable : function() {\n        // clean the bullets\n        for (var i = this._bullets.length - 1; i >= 0; i--)\n        {\n            var bullet = this._bullets[i];\n            bullet.doClean();\n        }\n        this._bullets = [];\n\n        if (this._armature) {\n            // remove the _armature from world clock\n            dragonBones.WorldClock.clock.remove(this._armature);\n        }\n    },\n\n    addBullet : function(bullet) {\n        this._bullets.push(bullet);\n    },\n\n    _enterFrameHandler : function (dt) {\n        for (var i = this._bullets.length - 1; i >= 0; i--)\n        {\n            var bullet = this._bullets[i];\n            if (bullet.update())\n            {\n                this._bullets.splice(i, 1);\n            }\n        }\n        dragonBones.WorldClock.clock.advanceTime(dt);\n    },\n\n    _animationEventHandler: function(event) {\n        if (event.type === dragonBones.EventObject.FADE_IN_COMPLETE) {\n            if (event.detail.animationState.name === \"jump_1\") {\n                this._isJumpingB = true;\n                this._speedY = -JUMP_SPEED;\n                this._armature.animation.fadeIn(\"jump_2\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            } else if (event.detail.animationState.name === \"jump_4\") {\n                this._updateAnimation();\n            }\n        }\n        else if (event.type === dragonBones.EventObject.FADE_OUT_COMPLETE) {\n            if (event.detail.animationState.name === \"attack_01\") {\n                this._isAttackingB = false;\n                this._attackState = null;\n            }\n        }\n    },\n\n    _frameEventHandler : function (event) {\n        if (event.detail.name === \"onFire\") {\n            var firePointBone = event.detail.armature.getBone(\"firePoint\");\n            var localPoint = cc.p(firePointBone.global.x, -firePointBone.global.y);\n\n            var display = event.detail.armature.display;\n            var globalPoint = display.convertToWorldSpace(localPoint);\n\n            this._fire(globalPoint);\n        }\n    },\n\n    _fire : function (firePoint) {\n        firePoint.x += Math.random() * 2 - 1;\n        firePoint.y += Math.random() * 2 - 1;\n\n        var armature = this._armatureDisplay.buildArmature(\"bullet_01\");\n        var effect = this._armatureDisplay.buildArmature(\"fireEffect_01\");\n        var radian = this._faceDir < 0 ? Math.PI - this._aimRadian : this._aimRadian;\n        var bullet = new DragonBullet();\n        bullet.init(this.node.parent._sgNode, armature, effect, radian + Math.random() * 0.02 - 0.01, 40, firePoint);\n        this.addBullet(bullet);\n    },\n\n    _updateAnimation : function() {\n        if (this._isJumpingA) {\n            return;\n        }\n\n        if (this._isSquating) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"squat\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            this._walkState = null;\n            return;\n        }\n\n        if (this._moveDir === 0) {\n            this._speedX = 0;\n            this._armature.animation.fadeIn(\"idle\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            this._walkState = null;\n        } else {\n            if (!this._walkState) {\n                this._walkState = this._armature.animation.fadeIn(\"walk\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._walkState.timeScale = MAX_MOVE_SPEED_FRONT / NORMALIZE_MOVE_SPEED;\n            } else {\n                this._walkState.timeScale = -MAX_MOVE_SPEED_BACK / NORMALIZE_MOVE_SPEED;\n            }\n\n            if (this._moveDir * this._faceDir > 0) {\n                this._speedX = MAX_MOVE_SPEED_FRONT * this._faceDir;\n            } else {\n                this._speedX = -MAX_MOVE_SPEED_BACK * this._faceDir;\n            }\n        }\n    },\n\n    _updatePosition : function() {\n        if (this._speedX !== 0) {\n            this.node.x += this._speedX;\n            var minX = -cc.visibleRect.width / 2;\n            var maxX = cc.visibleRect.width / 2;\n            if (this.node.x < minX) {\n                this.node.x = minX;\n            } else if (this.node.x > maxX) {\n                this.node.x = maxX;\n            }\n        }\n\n        if (this._speedY != 0) {\n            if (this._speedY > 5 && this._speedY + G <= 5) {\n                this._armature.animation.fadeIn(\"jump_3\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n            }\n\n            this._speedY += G;\n\n            this.node.y += this._speedY;\n            if (this.node.y < GROUND) {\n                this.node.y = GROUND;\n                this._isJumpingA = false;\n                this._isJumpingB = false;\n                this._speedY = 0;\n                this._speedX = 0;\n                this._armature.animation.fadeIn(\"jump_4\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n                if (this._isSquating || this._moveDir) {\n                    this._updateAnimation();\n                }\n            }\n        }\n    },\n\n    _updateAim : function () {\n        if (this._aimDir === 0) {\n            return;\n        }\n\n        this._faceDir = this._target.x > this.node.x ? 1 : -1;\n        if (this.node.scaleX * this._faceDir < 0) {\n            this.node.scaleX *= -1;\n            if (this._moveDir) {\n                this._updateAnimation();\n            }\n        }\n\n        var aimOffsetY = this._armature.getBone(\"chest\").global.y * this.node.scaleY;\n\n        if (this._faceDir > 0) {\n            this._aimRadian = Math.atan2(-(this._target.y - this.node.y + aimOffsetY), this._target.x - this.node.x);\n        } else {\n            this._aimRadian = Math.PI - Math.atan2(-(this._target.y - this.node.y + aimOffsetY), this._target.x - this.node.x);\n            if (this._aimRadian > Math.PI) {\n                this._aimRadian -= Math.PI * 2;\n            }\n        }\n\n        let aimDir = 0;\n        if (this._aimRadian > 0) {\n            aimDir = -1;\n        } else {\n            aimDir = 1;\n        }\n\n        if (this._aimDir != aimDir) {\n            this._aimDir = aimDir;\n\n            // Animation mixing.\n            if (this._aimDir >= 0) {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aimUp\", 0, 1,\n                    0, AIM_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n                );\n            } else {\n                this._aimState = this._armature.animation.fadeIn(\n                    \"aimDown\", 0, 1,\n                    0, AIM_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n                );\n            }\n\n            // Add bone mask.\n            //_aimState.addBoneMask(\"pelvis\");\n        }\n\n        this._aimState.weight = Math.abs(this._aimRadian / Math.PI * 2);\n\n        //_armature.invalidUpdate(\"pelvis\"); // Only update bone mask.\n        this._armature.invalidUpdate();\n    },\n\n    _updateAttack : function() {\n        if (!this._isAttackingA || this._isAttackingB) {\n            return;\n        }\n\n        this._isAttackingB = true;\n\n        // Animation mixing.\n        this._attackState = this._armature.animation.fadeIn(\n            \"attack_01\", -1, -1,\n            0, ATTACK_ANIMATION_GROUP, dragonBones.AnimationFadeOutMode.SameGroup\n        );\n\n        this._attackState.autoFadeOutTime = this._attackState.fadeTotalTime;\n        this._attackState.addBoneMask(\"pelvis\");\n    }\n});\n\n\nvar DragonBullet = cc.Class({\n    name: 'DragonBullet',\n    _speedX : 0,\n    _speedY : 0,\n\n    _armature : null,\n    _armatureDisplay : null,\n    _effect : null,\n\n    init : function (parentNode, armature, effect, radian, speed, position) {\n        this._speedX = Math.cos(radian) * speed;\n        this._speedY = -Math.sin(radian) * speed;\n        var thePos = parentNode.convertToNodeSpace(position);\n\n        this._armature = armature;\n        this._armatureDisplay = this._armature.display;\n        this._armatureDisplay.setPosition(thePos);\n        this._armatureDisplay.rotation = radian * dragonBones.DragonBones.RADIAN_TO_ANGLE;\n        this._armature.animation.play(\"idle\");\n\n        if (effect) {\n            this._effect = effect;\n            var effectDisplay = this._effect.display;\n            effectDisplay.rotation = radian * dragonBones.DragonBones.RADIAN_TO_ANGLE;\n            effectDisplay.setPosition(thePos);\n            effectDisplay.scaleX = 1 + Math.random() * 1;\n            effectDisplay.scaleY = 1 + Math.random() * 0.5;\n            if (Math.random() < 0.5) {\n                effectDisplay.scaleY *= -1;\n            }\n\n            this._effect.animation.play(\"idle\");\n\n            dragonBones.WorldClock.clock.add(this._effect);\n            parentNode.addChild(effectDisplay);\n        }\n\n        dragonBones.WorldClock.clock.add(this._armature);\n        parentNode.addChild(this._armatureDisplay);\n    },\n\n    update : function() {\n        this._armatureDisplay.x += this._speedX;\n        this._armatureDisplay.y += this._speedY;\n\n        var worldPos = this._armatureDisplay.parent.convertToWorldSpace(this._armatureDisplay.getPosition());\n        if (\n            worldPos.x < -100 || worldPos.x >= cc.visibleRect.width + 100 ||\n            worldPos.y < -100 || worldPos.y >= cc.visibleRect.height + 100\n        ) {\n            this.doClean();\n            return true;\n        }\n\n        return false;\n    },\n\n    doClean : function() {\n        dragonBones.WorldClock.clock.remove(this._armature);\n        this._armatureDisplay.removeFromParent();\n        this._armature.dispose();\n\n        if (this._effect) {\n            dragonBones.WorldClock.clock.remove(this._effect);\n            this._effect.display.removeFromParent();\n            this._effect.dispose();\n        }\n    }\n});\n} // end of !cc.runtime\n"]}