{"version":3,"sources":["../../../../../assets/cases/camera/assets/cases/camera/moving-objects.js"],"names":["cc","Class","extends","Component","properties","tempPrefab","default","type","Node","camera","root","moveSpeed","nodeCount","_useCamera","useCamera","get","set","v","CC_EDITOR","movingNode","x","active","_enableCulling","enableCulling","setMacroCulling","onEnable","_originEnableCulling","macro","ENABLE_CULLING","onDisable","onLoad","console","log","i","node","instantiate","Math","random","y","parent","enable","CC_JSB","director","getScene","_sgNode","_renderCmd","setDirtyFlag","_ccsg","_dirtyFlags","cullingDirty","renderer","childrenOrderDirty","update","dt","useCameraChanged","toggle","isChecked","enableCullingChanged"],"mappings":"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","file":"moving-objects.js","sourceRoot":"../../../../../assets/cases/camera","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tempPrefab: {\n            default: null,\n            type: cc.Node\n        },\n        camera: {\n            default: null,\n            type: cc.Node\n        },\n        root: {\n            default: null,\n            type: cc.Node\n        },\n\n        moveSpeed: 100,\n        nodeCount: 2000,\n\n        _useCamera: true,\n        useCamera: {\n            get: function () {\n                return this._useCamera;\n            },\n            set: function (v) {\n                if (this._useCamera === v) return;\n\n                this._useCamera = v;\n\n                if (!CC_EDITOR && this.movingNode) {\n                    this.movingNode = v ? this.camera : this.root;\n                    this.camera.x = this.root.x = 0;\n                    this.moveSpeed = -this.moveSpeed;\n                    this.camera.active = !!v;\n                }\n            }\n        },\n\n        _enableCulling: true,\n        enableCulling: {\n            get: function () {\n                return this._enableCulling;\n            },\n            set: function (v) {\n                this._enableCulling = v;\n                this.setMacroCulling(v);\n            }\n        }\n    },\n\n    onEnable: function () {\n        this._originEnableCulling = cc.macro.ENABLE_CULLING;\n    },\n\n    onDisable: function () {\n        this.setMacroCulling(this._originEnableCulling);\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        console.log(\"aaaa\");\n        for (var i = 0; i < this.nodeCount; i++) {\n            var node = cc.instantiate(this.tempPrefab);\n            node.x = (Math.random() - 0.5) * 960;\n            node.y = (Math.random() - 0.5) * 640;\n            node.parent = this.root;\n        }\n\n        this.movingNode = this._useCamera ? this.camera : this.root;\n        \n        this.setMacroCulling(this._enableCulling);\n    },\n    \n    setMacroCulling: function (enable) {\n        if (cc.macro.ENABLE_CULLING === enable || CC_JSB) return;\n\n        cc.macro.ENABLE_CULLING = enable;\n        cc.director.getScene()._sgNode._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.cullingDirty);\n        cc.renderer.childrenOrderDirty = true;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        this.movingNode.x += this.moveSpeed * dt;\n        if ((this.moveSpeed > 0 && this.movingNode.x > 900) || \n            (this.moveSpeed < 0 && this.movingNode.x < -900)) {\n            this.moveSpeed *= -1;\n        }\n    },\n\n    useCameraChanged: function (toggle) {\n        this.useCamera = toggle.isChecked;\n    },\n\n    enableCullingChanged: function (toggle) {\n        this.enableCulling = toggle.isChecked;\n    }\n});\n"]}