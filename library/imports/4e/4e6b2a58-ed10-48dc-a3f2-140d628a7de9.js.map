{"version":3,"sources":["../../../../../assets/cases/anysdk/assets/cases/anysdk/AnySDKList.js"],"names":["cc","Class","extends","Component","properties","itemPrefab","default","type","Prefab","scrollView","ScrollView","bufferZone","interfaceList","String","scriptName","onLoad","tips","node","parent","getChildByName","exampleComp","getComponent","isSupported","hasSupport","opacity","initItemCount","length","itemList","updateTimer","updateInterval","lastContentPosY","initList","system","y","height","i","item","instantiate","itemName","init","addChild","updateItem","push","invoke","index","getPositionInView","worldPos","convertToWorldSpaceAR","position","viewPos","convertToNodeSpaceAR","update","dt","items","buffer","isDown","offset","itemNode","newIdx","newInfo"],"mappings":"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","file":"AnySDKList.js","sourceRoot":"../../../../../assets/cases/anysdk","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scrollView: cc.ScrollView,\n        bufferZone: 0, // when item is away from bufferZone, we relocate it\n        interfaceList: [cc.String],\n        scriptName: \"\"\n    },\n\n    onLoad () {\n        var tips = this.scrollView.node.parent.getChildByName('Tips');\n        var exampleComp = this.scrollView.node.getComponent('BaseAnySDKExample');\n        var isSupported = exampleComp.hasSupport();\n        if (!isSupported) return;\n        tips.opacity = 0;\n        this.node.parent.parent.opacity = 255;\n        this.initItemCount = this.interfaceList.length;\n        this.itemList = [];\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosY = 0; // use this variable to detect if we are scrolling up or down\n        this.initList();\n        this.system = this.scrollView.getComponent(this.scriptName) ;\n    },\n\n    // use this for initialization\n    initList () {\n        let y = 0;\n        this.node.height = (this.interfaceList.length + 1) * 50;\n        for (let i = 0; i < this.initItemCount; ++i) {\n            let item = cc.instantiate(this.itemPrefab).getComponent('AnySDKItem');\n            let itemName = this.interfaceList[i];\n            item.init(this);\n            this.node.addChild(item.node);\n            y -= 50;\n            item.updateItem (i, y, itemName);\n            this.itemList.push(item);\n        }\n    },\n    \n    invoke: function(index){\n        if(index >= this.interfaceList.length) return;\n        this.system[this.interfaceList[index]]();\n    },\n\n    getPositionInView: function (item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    },\n\n    update (dt) {\n        this.updateTimer += dt;\n        if (this.updateTimer < this.updateInterval) {\n            return; // we don't need to do the math every frame\n        }\n        this.updateTimer = 0;\n        let items = this.itemList;\n        let buffer = this.bufferZone;\n        let isDown = this.node.y < this.lastContentPosY; // scrolling direction\n        let offset = 50 * (this.initItemCount - 1);\n        for (let i = 0; i < this.initItemCount; ++i) {\n            let item = items[i];\n            let itemNode = item.node;\n            let viewPos = this.getPositionInView(itemNode);\n            if (isDown) {\n                // if away from buffer zone and not reaching top of content\n                if (viewPos.y < -buffer && itemNode.y + offset < 0) {\n                    let newIdx = item.index - (this.initItemCount - 1);\n                    let newInfo = this.interfaceList[newIdx];\n                    item.updateItem(newIdx, itemNode.y + offset, newInfo);\n                }\n            } else {\n                // if away from buffer zone and not reaching bottom of content\n                if (viewPos.y > buffer && itemNode.y - offset > -this.node.height) {\n                    let newIdx = item.index + (this.initItemCount - 1);\n                    let newInfo = this.interfaceList[newIdx];\n                    item.updateItem(newIdx, itemNode.y - offset, newInfo);\n                }\n            }\n        }\n        // update lastContentPosY\n        this.lastContentPosY = this.node.y;\n    },\n});\n"]}